# PDF Generator API - AI Agent Documentation

**For AI Coding Teams:** Read this file to understand how to integrate with the PDF Generator API server.

## Overview

This is a RESTful API service that converts HTML to PDF using Puppeteer. The server is deployed on Railway and provides a simple POST endpoint to generate PDFs with download links.

## Base URL

```
Production: https://your-app.railway.app
Development: http://localhost:3001
```

## Core API Endpoint

### Generate PDF from HTML

**Endpoint:** `POST /api/generate-pdf`

**Content-Type:** `application/json`

**Request Body:**

```json
{
  "html": "<html><body>Your HTML content here</body></html>",
  "options": {
    "format": "A4",
    "printBackground": true,
    "margin": {
      "top": "1cm",
      "right": "1cm",
      "bottom": "1cm",
      "left": "1cm"
    },
    "preferCSSPageSize": false
  }
}
```

**Required Fields:**
- `html` (string): HTML content to convert to PDF

**Optional Fields:**
- `options.format` (string): Paper format - "A4", "Letter", "Legal", "Tabloid", etc. Default: "A4"
- `options.printBackground` (boolean): Print background graphics. Default: true
- `options.margin` (object): Page margins with top, right, bottom, left properties. Each can be a value with unit (e.g., "1cm", "20px"). Default: "1cm" for all sides
- `options.preferCSSPageSize` (boolean): Use CSS page size. Default: false

**Success Response (200):**

```json
{
  "success": true,
  "pdfId": "550e8400-e29b-41d4-a716-446655440000",
  "downloadUrl": "https://your-app.railway.app/api/download/550e8400-e29b-41d4-a716-446655440000",
  "expiresAt": "2026-01-02T12:05:00.000Z"
}
```

**Error Response (400):**

```json
{
  "error": "HTML content is required"
}
```

**Error Response (500):**

```json
{
  "error": "Failed to generate PDF",
  "message": "Error details here"
}
```

## Download Endpoint

### Download Generated PDF

**Endpoint:** `GET /api/download/:pdfId`

**Parameters:**
- `pdfId` (path parameter): PDF ID returned from generation endpoint

**Response:**
- Binary PDF file download
- Browser will prompt to save as `document-{pdfId}.pdf`

**Error Response (404):**

```json
{
  "error": "PDF not found or has expired"
}
```

## Helper Endpoints

### Health Check

**Endpoint:** `GET /health`

**Response (200):**

```json
{
  "status": "ok",
  "timestamp": "2026-01-02T12:00:00.000Z"
}
```

### API Documentation

**Endpoint:** `GET /`

**Response (200):**

Returns JSON with available endpoints and usage examples.

## Implementation Examples

### JavaScript / Node.js

```javascript
const response = await fetch('https://your-app.railway.app/api/generate-pdf', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    html: `
      <!DOCTYPE html>
      <html>
      <head>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; }
          h1 { color: #333; }
        </style>
      </head>
      <body>
        <h1>Hello World</h1>
        <p>This is a PDF generated by the API.</p>
      </body>
      </html>
    `,
    options: {
      format: 'A4',
      printBackground: true
    }
  })
});

const { success, downloadUrl, expiresAt } = await response.json();

if (success) {
  console.log('PDF ready for download:', downloadUrl);
  console.log('Expires at:', expiresAt);
}
```

### Python

```python
import requests
from datetime import datetime

url = 'https://your-app.railway.app/api/generate-pdf'

payload = {
    'html': '''
    <!DOCTYPE html>
    <html>
    <head>
        <style>
            body { font-family: Arial, sans-serif; padding: 20px; }
            h1 { color: #333; }
        </style>
    </head>
    <body>
        <h1>Hello World</h1>
        <p>This is a PDF generated by the API.</p>
    </body>
    </html>
    ''',
    'options': {
        'format': 'A4',
        'printBackground': True
    }
}

response = requests.post(url, json=payload)
data = response.json()

if data.get('success'):
    print('PDF URL:', data['downloadUrl'])
    print('Expires:', data['expiresAt'])
    
    # Download the PDF
    pdf_response = requests.get(data['downloadUrl'])
    with open('output.pdf', 'wb') as f:
        f.write(pdf_response.content)
```

### cURL

```bash
curl -X POST https://your-app.railway.app/api/generate-pdf \
  -H "Content-Type: application/json" \
  -d '{
    "html": "<html><body><h1>Hello World</h1></body></html>",
    "options": {
      "format": "A4",
      "printBackground": true
    }
  }'
```

### PHP

```php
<?php
$url = 'https://your-app.railway.app/api/generate-pdf';

$data = [
    'html' => '<html><body><h1>Hello World</h1></body></html>',
    'options' => [
        'format' => 'A4',
        'printBackground' => true
    ]
];

$ch = curl_init($url);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'Content-Type: application/json'
]);

$response = curl_exec($ch);
curl_close($ch);

$result = json_decode($response, true);

if ($result['success']) {
    echo "PDF URL: " . $result['downloadUrl'] . "\n";
}
?>
```

### Ruby

```ruby
require 'net/http'
require 'json'
require 'uri'

uri = URI.parse('https://your-app.railway.app/api/generate-pdf')
header = { 'Content-Type': 'application/json' }

body = {
  html: '<html><body><h1>Hello World</h1></body></html>',
  options: {
    format: 'A4',
    printBackground: true
  }
}

req = Net::HTTP::Post.new(uri, header)
req.body = body.to_json

res = Net::HTTP.start(uri.hostname, uri.port, use_ssl: true) do |http|
  http.request(req)
end

data = JSON.parse(res.body)

if data['success']
  puts "PDF URL: #{data['downloadUrl']}"
end
```

### Go

```go
package main

import (
    "bytes"
    "encoding/json"
    "fmt"
    "net/http"
)

type PDFRequest struct {
    HTML    string      `json:"html"`
    Options PDFOptions  `json:"options"`
}

type PDFOptions struct {
    Format          string            `json:"format"`
    PrintBackground bool              `json:"printBackground"`
    Margin          map[string]string `json:"margin"`
}

type PDFResponse struct {
    Success     bool   `json:"success"`
    PDFID       string `json:"pdfId"`
    DownloadURL string `json:"downloadUrl"`
    ExpiresAt   string `json:"expiresAt"`
}

func main() {
    reqBody := PDFRequest{
        HTML: "<html><body><h1>Hello World</h1></body></html>",
        Options: PDFOptions{
            Format:          "A4",
            PrintBackground: true,
            Margin: map[string]string{
                "top":    "1cm",
                "right":  "1cm",
                "bottom": "1cm",
                "left":   "1cm",
            },
        },
    }

    jsonData, _ := json.Marshal(reqBody)
    
    resp, _ := http.Post(
        "https://your-app.railway.app/api/generate-pdf",
        "application/json",
        bytes.NewBuffer(jsonData),
    )
    
    var result PDFResponse
    json.NewDecoder(resp.Body).Decode(&result)
    
    if result.Success {
        fmt.Println("PDF URL:", result.DownloadURL)
    }
}
```

## Common Use Cases

### Use Case 1: Invoice Generation

```json
{
  "html": "<html><body><h1>Invoice #12345</h1><p>Amount: $500.00</p></body></html>",
  "options": {
    "format": "Letter",
    "printBackground": true
  }
}
```

### Use Case 2: Report with Styling

```json
{
  "html": "<html><head><style>table { border-collapse: collapse; width: 100%; } th, td { border: 1px solid black; padding: 8px; }</style></head><body><table><tr><th>Name</th><th>Value</th></tr><tr><td>Item 1</td><td>$100</td></tr></table></body></html>",
  "options": {
    "format": "A4",
    "printBackground": true,
    "margin": { "top": "2cm", "right": "2cm", "bottom": "2cm", "left": "2cm" }
  }
}
```

### Use Case 3: Certificate

```json
{
  "html": "<html><body style='text-align: center; padding: 50px;'><h1>Certificate of Completion</h1><p>This certifies that John Doe has completed the course.</p></body></html>",
  "options": {
    "format": "Letter",
    "printBackground": true
  }
}
```

## Important Notes

### PDF Expiration
- Generated PDFs are automatically deleted after 5 minutes
- Download the PDF before it expires
- The `expiresAt` field in the response indicates when the PDF will be deleted

### File Size Limits
- Maximum HTML input size: 10MB
- Typical PDF size depends on content complexity

### Timeout
- PDF generation timeout: 30 seconds
- If timeout occurs, reduce HTML complexity or increase timeout in server code

### Supported CSS Features
- Basic CSS styling works well
- CSS Flexbox and Grid are supported
- Background colors and images work when `printBackground: true`
- JavaScript execution is supported (with limitations)

### Common CSS Tips
- Use absolute units for reliable printing (cm, mm, px)
- Test print layout with browser print preview
- Avoid viewport-specific CSS (media queries)
- Use page-break CSS for multi-page documents:
  ```css
  .page-break { page-break-before: always; }
  ```

## Error Handling

### Always Check Response Status
```javascript
const response = await fetch(url, { ... });
if (!response.ok) {
  const error = await response.json();
  console.error('Error:', error.error);
  return;
}
```

### Handle PDF Expiration
```python
import datetime
expires_at = datetime.datetime.fromisoformat(data['expiresAt'])
if datetime.datetime.now() > expires_at:
    print("PDF has expired, regenerate if needed")
```

### Retry Logic
```javascript
async function generatePDF(html, options, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      const response = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ html, options })
      });
      
      if (response.ok) {
        return await response.json();
      }
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
}
```

## Testing

### Test Locally
1. Start the server: `npm start`
2. Run test script: `node test-api.js`
3. Check generated PDF in `/pdfs` directory

### Test Production
```bash
curl -X POST https://your-app.railway.app/api/generate-pdf \
  -H "Content-Type: application/json" \
  -d '{"html":"<html><body><h1>Test</h1></body></html>","options":{"format":"A4"}}'
```

## Quick Reference Card

```
POST /api/generate-pdf
  Body: { html: string, options?: object }
  Response: { success: bool, pdfId: string, downloadUrl: string, expiresAt: string }

GET /api/download/:pdfId
  Response: Binary PDF file

GET /health
  Response: { status: "ok", timestamp: string }

GET /
  Response: API documentation
```

## Support

For issues or questions:
1. Check the response error messages
2. Verify HTML is valid
3. Check server health at `/health`
4. Ensure PDF hasn't expired (5-minute limit)

---

**Last Updated:** 2026-01-02
**API Version:** 1.0.0
